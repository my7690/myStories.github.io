<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ‚Ø¹ Ø±ÙˆØ§ÙŠØ§ØªÙŠ</title>

    <!-- Firebase CDN (App + Firestore ÙÙ‚Ø·) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        /* ===== STYLES (Ù†ÙØ³ Ù†Ø³Ø®ØªÙƒ) ===== */

        :root {
            --primary-color: #60a5fa;
            --secondary-color: #e0f2fe;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --shadow: 0 8px 25px rgba(37, 99, 235, 0.12);
            --gradient: linear-gradient(135deg, #bfdbfe 0%, #60a5fa 50%, #1d4ed8 100%);
        }

        .hidden { display:none; }

        body { margin:0; font-family: "Tajawal", sans-serif; background:#f6faff; }

        /* NAV */
        .navbar { background:var(--gradient); padding:1rem 2rem; color:white; }

        .nav-container { max-width:1200px; margin:auto; display:flex; justify-content:space-between; align-items:center; }

        .nav-links { display:flex; gap:2rem; list-style:none; }
        .nav-links a { color:white; text-decoration:none; font-weight:bold; }

        /* Layout */
        .container { max-width:1200px; margin:auto; padding:2rem; }

        /* Simple sections */
        .main-header { background:var(--gradient); color:white; padding:2rem; border-radius:20px; text-align:center; }
        .story-reading, .ideas-section, .cafe-section {
            background:white; border-radius:20px; padding:2rem; margin-top:2rem; box-shadow:var(--shadow);
        }

        /* forms */
        textarea, input {
            width:100%; padding:0.8rem; border-radius:10px;
            border:2px solid var(--primary-color);
            background:white; margin-bottom:1rem;
        }

        button {
            padding:0.8rem 1.5rem; border:none; cursor:pointer;
            border-radius:20px; background:var(--gradient); color:white;
            font-size:1rem; font-weight:bold;
        }

    </style>
</head>

<body>

    <!-- ============ NAVBAR ============ -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#home" class="nav-logo">ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ØµØµ</a>
            <ul class="nav-links">
                <li><a href="#home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="#stories">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ØµØµ</a></li>
                <li><a href="#cafe">Ù…Ù‚Ù‡Ù‰ Ø§Ù„Ø­ÙˆØ§Ø±</a></li>
            </ul>
            <div class="user-section">Ø¶ÙŠÙˆÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ :)</div>
        </div>
    </nav>

    <!-- ============ HOME ============ -->
    <div id="homePage" class="container">
        <div class="main-header">
            <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ØµØµ</h1>
            <div id="themeIndicator">ğŸ©µ</div>
        </div>

        <div class="ideas-section">
            <h2>ğŸ’¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h2>
            <input id="ideaName" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <textarea id="ideaInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ..."></textarea>
            <button onclick="submitIdea()">Ø¥Ø±Ø³Ø§Ù„</button>
            <div id="ideasList" style="margin-top:2rem;"></div>
        </div>
    </div>

    <!-- ============ STORIES PAGE ============ -->
    <div id="storiesPage" class="container hidden">
        <button onclick="navigate('#home')">â† Ø±Ø¬ÙˆØ¹</button>
        <h1 style="text-align:center;">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ØµØµ</h1>
        <div id="storiesGrid" style="margin-top:2rem;"></div>
    </div>

    <!-- ============ CAFE PAGE ============ -->
    <div id="cafePage" class="container hidden">
        <button onclick="navigate('#home')">â† Ø±Ø¬ÙˆØ¹</button>
        <div class="cafe-section">
            <h2>â˜• Ù…Ù‚Ù‡Ù‰ Ø§Ù„Ø­ÙˆØ§Ø±</h2>

            <input id="discussionName" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <textarea id="discussionInput" placeholder="Ø§ÙƒØªØ¨ Ù†Ù‚Ø§Ø´Ùƒ..."></textarea>
            <button onclick="submitDiscussion()">Ù†Ø´Ø±</button>

            <div id="discussionsList" style="margin-top:2rem;"></div>
        </div>
    </div>

    <!-- ============ STORY READING ============ -->
    <div id="storyReadingSection" class="container hidden">
        <button onclick="navigate('#stories')">â† Ø±Ø¬ÙˆØ¹</button>
        <div id="storyContent" class="story-reading"></div>
        <button onclick="navigate('#questions')">Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
    </div>

    <!-- ============ QUESTIONS ============ -->
    <div id="questionsSection" class="container hidden">
        <button onclick="navigate('#story-'+currentStoryId)">â† Ø±Ø¬ÙˆØ¹</button>

        <div class="ideas-section">
            <h2>ğŸ’­ ÙÙƒØ± ÙÙŠÙ‡Ø§...</h2>
            <input id="answersName" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <div id="questionsContainer"></div>
            <div id="answersContainer" style="margin-top:2rem;"></div>
        </div>
    </div>


    <!-- ============ SCRIPT ============ -->
    <script>
        /* ===============================
             Firebase Configuration
        ================================ */
        const firebaseConfig = {
            apiKey: "AIzaSyCTHtK0c0t9fSNmtukx8wSoZALrfnxmVhw",
            authDomain: "my-stories-site.firebaseapp.com",
            projectId: "my-stories-site",
            storageBucket: "my-stories-site.firebasestorage.app",
            messagingSenderId: "1027697190942",
            appId: "1:1027697190942:web:5798dc94e1358050caa60f",
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const serverTimestamp = firebase.firestore.FieldValue.serverTimestamp;

        /* ===============================
             Stories Data (Ù†ÙØ³ Ù†Ø³Ø®ØªÙƒ)
        ================================ */
        const stories = [
            { id:1, title:"Ø±Ø³Ø§Ø¦Ù„Ù†Ø§", category:"Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©", description:"Ù‚ØµØ© Ø­Ø¨...", content:"...", questions:["...","..."] },
            { id:2, title:"Ø²Ù…ÙŠÙ„ÙŠ", category:"Ø¯Ø±Ø§Ù…Ø§", description:"...", content:"...", questions:["...","..."] },
            { id:3, title:"Ø²ÙˆØ¬ØªÙ‡", category:"ØºÙ…ÙˆØ¶", description:"...", content:"...", questions:["...","..."] },
            { id:4, title:"Ø´ÙŠØ¡ Ù„ÙŠ", category:"Ø¯Ø±Ø§Ù…Ø§", description:"...", content:"...", questions:["...","..."] }
        ];

        let currentStoryId = null;

        /* ===============================
                PAGE NAVIGATION FIXED
           (Ø§Ù„Ø±ÙŠÙØ±ÙŠØ´ ÙŠØ±Ø¬Ù‘Ø¹ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø©)
        ================================ */

        function navigate(hash) {
            window.location.hash = hash;
        }

        function renderPage() {
            const hash = window.location.hash || "#home";

            hideAll();

            if (hash === "#home") return showHome();
            if (hash === "#stories") return showStories();
            if (hash === "#cafe") return showCafe();

            if (hash.startsWith("#story-")) {
                const id = Number(hash.replace("#story-", ""));
                return showStory(id);
            }

            if (hash === "#questions") {
                return showQuestions();
            }

            showHome();
        }

        window.addEventListener("hashchange", renderPage);
        window.addEventListener("load", renderPage);

        function hideAll() {
            document.querySelectorAll(".container").forEach(c => c.classList.add("hidden"));
        }

        /* ===============================
                    HOME
        ================================ */

        function showHome() {
            document.getElementById("homePage").classList.remove("hidden");
            displayIdeas();
        }

        /* ===============================
                    STORIES
        ================================ */
        function showStories() {
            document.getElementById("storiesPage").classList.remove("hidden");

            const grid = document.getElementById("storiesGrid");
            grid.innerHTML = stories.map(s => `
                <div onclick="navigate('#story-${s.id}')" 
                     style="background:white; padding:1.5rem; border-radius:15px; box-shadow:var(--shadow); cursor:pointer;">
                    <span>${s.category}</span>
                    <h3>${s.title}</h3>
                    <p>${s.description}</p>
                </div>
            `).join("");
        }

        /* ===============================
                    READ STORY
        ================================ */
        function showStory(id) {
            currentStoryId = id;
            const story = stories.find(s => s.id === id);

            document.getElementById("storyReadingSection").classList.remove("hidden");

            document.getElementById("storyContent").innerHTML = `
                <h2>${story.title}</h2>
                <p>${story.content}</p>
            `;
        }

        /* ===============================
                    QUESTIONS
        ================================ */
        function showQuestions() {
            document.getElementById("questionsSection").classList.remove("hidden");

            const story = stories.find(s => s.id === currentStoryId);
            const container = document.getElementById("questionsContainer");

            container.innerHTML = story.questions.map((q,i)=>`
                <h3>${q}</h3>
                <textarea id="answer${i}"></textarea>
            `).join("");

            displayStoryAnswers();
        }

        /* ===============================
              FIRESTORE â€” Ideas + Cafe
        ================================ */

        async function submitIdea() {
            let text = document.getElementById("ideaInput").value.trim();
            let name = document.getElementById("ideaName").value.trim() || "Ù…Ø¬Ù‡ÙˆÙ„";

            if (!text) return alert("Ø§ÙƒØªØ¨ÙŠ Ø§Ù„ÙÙƒØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");

            await db.collection("ideas").add({
                text, userName:name, createdAt:serverTimestamp()
            });

            document.getElementById("ideaInput").value = "";
            displayIdeas();
        }

        async function displayIdeas() {
            const list = document.getElementById("ideasList");
            const snap = await db.collection("ideas").orderBy("createdAt","desc").get();

            list.innerHTML = snap.empty ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø¨Ø¹Ø¯" :
                snap.docs.map(d => {
                    let x = d.data();
                    return `<div style="margin-bottom:1rem; padding:1rem; background:var(--secondary-color); border-radius:10px;">
                        <b>${x.userName}</b><br>${x.text}
                    </div>`;
                }).join("");
        }

        /* ========== Cafe Discussions ========== */

        async function submitDiscussion() {
            let text = document.getElementById("discussionInput").value.trim();
            let name = document.getElementById("discussionName").value.trim() || "Ù…Ø¬Ù‡ÙˆÙ„";
            if (!text) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ù†Ù‚Ø§Ø´ Ø£ÙˆÙ„Ø§Ù‹");

            await db.collection("discussions").add({
                text, userName:name, likeCount:0, replies:[],
                createdAt:serverTimestamp()
            });

            document.getElementById("discussionInput").value = "";
            displayDiscussions();
        }

        async function displayDiscussions() {
            const list = document.getElementById("discussionsList");
            const snap = await db.collection("discussions").orderBy("createdAt","desc").get();

            if (snap.empty) {
                list.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø´Ø§Øª Ø¨Ø¹Ø¯";
                return;
            }

            list.innerHTML = snap.docs.map(doc => {
                const x = doc.data();
                return `
                    <div style="background:var(--secondary-color); padding:1rem; border-radius:10px; margin-bottom:1rem;">
                        <b>${x.userName}</b> â€” â¤ï¸ ${x.likeCount}<br>
                        ${x.text}
                    </div>
                `;
            }).join("");
        }

        /* ===============================
             Story Answers (Firestore)
        ================================ */

        async function displayStoryAnswers() {
            const box = document.getElementById("answersContainer");

            const snap = await db.collection("storyAnswers")
                .where("storyId","==",currentStoryId)
                .orderBy("createdAt","desc")
                .get();

            box.innerHTML = snap.empty ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ø¹Ø¯" :
                snap.docs.map(d => {
                    let x = d.data();
                    return `
                        <div style="background:var(--secondary-color); padding:1rem; border-radius:10px; margin-bottom:1rem;">
                            <b>${x.userName}</b><br>${x.text}
                        </div>
                    `;
                }).join("");
        }

    </script>
</body>
</html>
